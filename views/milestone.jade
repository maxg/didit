extends layout

append head
  title Milestone #{kind}/#{proj} #{name} - Didit

block content
  div.span12
    div.page-header
      h1 Milestone&nbsp;
        a(href="/#{kind}/#{proj}"): tt #{kind}/#{proj}
        |  #{name}&nbsp;
        small: a(href="/milestone/#{kind}/#{proj}/#{name}.csv") .csv
      div.btn-toolbar
        div.btn-group
          button.btn(href='#grade-from-sweep', data-toggle='modal') assign grades by sweep
          button.btn(href='#grade-from-revs', data-toggle='modal') assign grades by revision
        if milestone.released
          button.btn.btn-success.active grades released
        else
          button.btn(href='#release', data-toggle='modal') release grades
    
    form#grade-from-sweep.modal.hide(action="/grade/#{kind}/#{proj}/#{name}/sweep", method='post')
      div.modal-header
        a.close(data-dismiss='modal') &times;
        h3 Choose students and sweep
      div.modal-body
        label(for='grade-from-sweep-usernames') List usernames:
        textarea#grade-from-sweep-usernames.span8.teletype(rows=10, name='usernames')
        label(for='grade-from-sweep-sweep') Select sweep:
        select#grade-from-sweep-sweep.span8(name='datetime')
          option(disabled,selected)
          each sweep in sweeps
            option(value=sweep.when.format(moment.compactFormat)).
              #{sweep.kind}/#{sweep.proj} #{sweep.when.format('llll')}
      div.modal-footer
        a.btn(href='#', data-dismiss='modal') Cancel
        button.btn.btn-info Assign grades for #{kind}/#{proj} #{name}
    
    form.form-horizontal#grade-from-revs.modal.hide(action="/grade/#{kind}/#{proj}/#{name}/revs", method='post')
      div.modal-header
        a.close(data-dismiss='modal') &times;
        h3 Choose students and revisions
      div.modal-body
        each reporev in milestone.reporevs
          div.control-group
            label.control-label(for="revision-#{reporev.users.join('-')}")= reporev.users.join(' ')
            div.controls
              input(id="revision-#{reporev.users.join('-')}", type='text', name="revision[#{reporev.users.join('-')}]", pattern='[a-f0-9]{7}')
      div.modal-footer
        a.btn(href='#', data-dismiss='modal') Cancel
        button.btn.btn-info Assign grades for #{kind}/#{proj} #{name}
    
    form#release.modal.hide(action="/milestone/#{kind}/#{proj}/#{name}/release", method='post')
      div.modal-header
        a.close(data-dismiss='modal') &times;
        h3 Confirm grades release
      div.modal-body
        p Students will be able to access grade reports for this milestone.
      div.modal-footer
        a.btn(href='#', data-dismiss='modal') Cancel
        button.btn.btn-info Release grades for #{kind}/#{proj} #{name}
    
    include grades
    mixin grades(milestone.reporevs)
